if [ -S "$SSH_AUTH_SOCK" ] && [ "$SSH_AUTH_SOCK" != "$HOME/.ssh/agent.sock" ]; then
    mkdir -p "$HOME/.ssh"
    # Only recreate the symlink if it points to a different target
    current_target=$(readlink "$HOME/.ssh/agent.sock" 2>/dev/null || true)
    if [ "$current_target" != "$SSH_AUTH_SOCK" ]; then
        ln -snf "$SSH_AUTH_SOCK" "$HOME/.ssh/agent.sock"
    fi
    export SSH_AUTH_SOCK="$HOME/.ssh/agent.sock"
fi

